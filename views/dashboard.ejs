<%- include('partials/header') %>

<div class="container">

  <h1 class="mb-4">Dashboard de Productos</h1>

  <!-- ─── Tarjetas de estadísticas ─── -->
  <div class="row g-4 mb-5">

    <!-- Total de productos -->
    <div class="col-md-4">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="card-title text-muted">Total Productos</h5>
          <p class="display-4 fw-bold text-primary"><%= stats.totalProducts %></p>
        </div>
      </div>
    </div>

    <!-- Precio medio -->
    <div class="col-md-4">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="card-title text-muted">Precio Medio</h5>
          <p class="display-4 fw-bold text-success">$<%= stats.avgPrice %></p>
        </div>
      </div>
    </div>

    <!-- N.º de categorías -->
    <div class="col-md-4">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="card-title text-muted">Categorías</h5>
          <p class="display-4 fw-bold text-warning"><%= stats.byCategory.length %></p>
        </div>
      </div>
    </div>

  </div>

  <!-- ─── Gráfico de barras ─── -->
  <div class="card shadow-sm border-0 mb-5">
    <div class="card-body">
      <h5 class="card-title">Productos por Categoría</h5>
      <canvas id="categoryChart" height="120"></canvas>
    </div>
  </div>

</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>

<script>
  /**
   * Fetch /api/stats y dibuja un gráfico de barras con la cantidad
   * de productos por categoría usando Chart.js.
   */
  fetch('/api/stats')
    .then((res) => res.json())
    .then((data) => {
      const labels = data.byCategory.map((c) => c._id);
      const values = data.byCategory.map((c) => c.count);

      const ctx = document.getElementById('categoryChart').getContext('2d');

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            {
              label: 'Productos por categoría',
              data: values,
              backgroundColor: [
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 99, 132, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
              ],
              borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
              ],
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { precision: 0 },
            },
          },
        },
      });
    })
    .catch((err) => console.error('Error al cargar gráfico:', err));
</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
